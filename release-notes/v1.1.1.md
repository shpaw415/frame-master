# Release Notes - v1.1.1

> **Status:** Draft - Additional fixes and documentation updates pending

## üéØ Overview

This release focuses on enhancing the developer experience for plugin authors with new Builder API methods, comprehensive documentation improvements, and a refined README for better clarity.

---

## ‚ú® New Features

### Builder API Enhancements

The `builder` singleton now includes powerful analysis and debugging tools for plugin developers:

#### **`getConfig(): Bun.BuildConfig | null`**

Access the current merged build configuration from all plugins.

```typescript
import { builder } from "frame-master/build";

const config = builder.getConfig();
if (config) {
  console.log("Building for:", config.target);
  console.log("External packages:", config.external);
}
```

#### **`analyzeBuild()`**

Get detailed analysis of build outputs with size metrics and optimization insights.

```typescript
const analysis = builder.analyzeBuild();
console.log("Total size:", analysis.totalSize, "bytes");
console.log("Average file size:", analysis.averageSize, "bytes");
console.log("Largest files:", analysis.largestFiles);
console.log("By artifact kind:", analysis.byKind);
```

Returns:

- `totalSize`: Total bytes across all artifacts
- `averageSize`: Average file size
- `artifacts`: Array of all build outputs with metadata
- `largestFiles`: Top 10 largest files
- `byKind`: Statistics grouped by artifact kind (entry-point, chunk, etc.)

#### **`generateReport(format: "text" | "json")`**

Generate formatted build reports for logging or monitoring.

```typescript
// Human-readable report for console
console.log(builder.generateReport("text"));

// Structured JSON for monitoring systems
const report = builder.generateReport("json");
await sendToMonitoring(JSON.parse(report));
```

#### **`getBuildHistory()`**

Track build performance over time with historical data.

```typescript
const history = builder.getBuildHistory();
const avgDuration =
  history.reduce((s, b) => s + b.duration, 0) / history.length;
console.log("Average build time:", avgDuration.toFixed(2), "ms");

// Check for regressions
const lastBuild = history[history.length - 1];
console.log("Last build:", lastBuild.success ? "‚úÖ" : "‚ùå");
```

#### **`clearBuildHistory()`**

Reset build history tracking.

```typescript
builder.clearBuildHistory();
```

### Type-Safe Configuration Helper

#### **`defineBuildConfig<T>(config: T): T`**

New helper function for type-safe build configurations with full IntelliSense support.

```typescript
import { defineBuildConfig } from "frame-master/build";

export function myPlugin(): FrameMasterPlugin {
  return {
    name: "my-plugin",
    build: {
      buildConfig: defineBuildConfig({
        target: "browser", // Full autocomplete!
        external: ["react", "react-dom"],
        minify: process.env.NODE_ENV === "production",
        // TypeScript catches typos and invalid values
      }),
    },
  };
}
```

**Benefits:**

- Zero runtime overhead (identity function)
- Full TypeScript IntelliSense
- Prevents configuration errors at development time

### Improved Error Handling

#### **Enhanced Circular Dependency Detection**

Frame-Master now provides clear, actionable error messages when circular dependencies are detected in configuration files.

**New error message includes:**

- üé® **Colorful, formatted output** using chalk for better visibility
- üìã **Clear explanation** of what went wrong
- üîç **Common causes** listed:
  - Accessing config values at module level (top-level)
- ‚úÖ **Actionable solutions**:
  - Access config inside plugin hooks (serverStart, router, etc.)
  - Set config as module-scoped variable via import inside serverStart hook
  - Move config-dependent code into lifecycle hooks
- üìñ **Documentation link**: https://frame-master.com/docs/configuration#limitations
- ‚ùå **Throws error** to prevent application from running with broken configuration

**Example error output:**

```
================================================================================
‚ùå CIRCULAR DEPENDENCY DETECTED IN CONFIG
================================================================================

‚ö†Ô∏è  Your configuration file has a circular dependency.

Common causes:
  ‚Ä¢ Trying to access config values at the module level (top-level)

Solution:
  ‚úì Access config values inside plugin hooks (serverStart, router, etc.)
  ‚úì set config as module scopped variable via import inside serverStart hook
  ‚úì Move config-dependent code into lifecycle hooks

üìñ Documentation: https://frame-master.com/docs/configuration#limitations
================================================================================

Error: Frame-Master: Circular dependency in configuration file. Cannot continue.
```

This prevents hard-to-debug runtime issues and guides developers to the correct pattern immediately.

---

## üìö Documentation Improvements

### README Refinement

Complete rewrite of the README to reduce bloat and improve clarity:

- **21% reduction** in length (685 ‚Üí 538 lines) while preserving all critical information
- **Clearer positioning**: Frame-Master as a "plugin orchestration runtime"
- **Emphasized zero built-in behavior**: No opinions, routes, or renderers by default
- **Singleton builder pattern**: Clear explanation of how all plugins share one build pipeline
- **Runtime vs Build plugins**: Clear distinction with comparison table
- **Condensed examples**: Removed redundant code and comments
- **Better structure**: Information flows more logically with less repetition

Key sections improved:

- Core Philosophy (more concise)
- Architecture (simplified diagram)
- Plugin System (consolidated examples)
- Singleton Builder Pattern (single clear example)
- Builder API (3 concise sections vs verbose paragraphs)

### Enhanced Type Documentation

**`BuildOptionsPlugin` type** now includes:

- **Static vs Dynamic configs**: Clear explanation of when to use each
- **Singleton pattern details**: How all plugins share the builder
- **Intelligent merging strategies**: How configs from multiple plugins merge
  - Arrays: Deduplicated and concatenated
  - Objects: Deep merged
  - Plugins: Concatenated (preserve order)
  - Primitives: Last wins with warning
- **15+ practical examples**: Real-world usage patterns
- **Comprehensive hook documentation**: Every hook explained with examples

---

## üîß API Changes

### New Exports

```typescript
// All new exports (backward compatible)
import {
  builder, // Existing
  Builder, // Existing
  defineBuildConfig, // NEW
} from "frame-master/build";
```

### Builder Class

**New public methods:**

- `getConfig()`
- `analyzeBuild()`
- `generateReport(format)`
- `getBuildHistory()`
- `clearBuildHistory()`

**New static helper:**

- `defineBuildConfig<T>(config: T): T`

---

## üí° Usage Examples

### Bundle Size Monitoring

```typescript
export function monitoringPlugin(): FrameMasterPlugin {
  return {
    name: "monitoring",
    build: {
      afterBuild: async (config, result, builder) => {
        const analysis = builder.analyzeBuild();

        if (analysis.totalSize > 2_000_000) {
          console.error("‚ùå Bundle exceeds 2MB limit!");
          process.exit(1);
        }

        await fetch("https://monitor.example.com/builds", {
          method: "POST",
          body: builder.generateReport("json"),
        });
      },
    },
  };
}
```

### Performance Tracking

```typescript
export function perfPlugin(): FrameMasterPlugin {
  return {
    name: "perf-tracker",
    build: {
      afterBuild: async () => {
        const history = builder.getBuildHistory();
        const last10 = history.slice(-10);
        const avg = last10.reduce((s, b) => s + b.duration, 0) / last10.length;

        console.log(`üìä Last 10 builds avg: ${avg.toFixed(2)}ms`);

        if (avg > 5000) {
          console.warn("‚ö†Ô∏è Builds are getting slow! Consider optimizing.");
        }
      },
    },
  };
}
```

---

## üîÑ Breaking Changes

**None** - All changes are backward compatible.

---

## üêõ Bug Fixes

_(To be added)_

---

## üìñ Additional Documentation

_(To be added)_

---

## üôè Credits

Special thanks to Bun.js for so much work done!

---

## üì¶ Installation

```bash
# Update to v1.1.1
bun add -g frame-master@1.1.1

# Or in your project
bun add frame-master@1.1.1
```

---

## üîó Links

- [Full Changelog](https://github.com/shpaw415/frame-master/compare/v1.1.0...v1.1.1)
- [Documentation](https://frame-master.com/docs)
- [Plugin Development Guide](https://frame-master.com/docs/plugins)

---

**Note:** This is a draft release note. Additional bug fixes and documentation updates will be added before final release.
