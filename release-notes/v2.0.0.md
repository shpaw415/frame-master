# Release Notes - v2.0.0

> **Status:** Draft - Additional fixes and documentation updates pending

## üéØ Overview

This release focuses on enhancing the developer experience with architectural improvements that eliminate circular dependency issues, new Builder API methods for debugging and analysis, CLI enhancements, comprehensive testing, and documentation refinements.

**Highlights:**

- ‚ú® **Eliminated circular dependencies** through lazy initialization pattern
- üîß **6 new Builder API methods** for build analysis and monitoring
- üñ•Ô∏è **Enhanced CLI** with build lifecycle info display
- üß™ **Comprehensive CLI test suite** for reliability
- üìö **21% smaller README** with clearer explanations
- üõ°Ô∏è **Type-safe configuration helper** with full IntelliSense
- üîÑ **Safer config access pattern** via `getConfig()` function

---

## ‚ú® New Features

### Builder API Enhancements

The `builder` singleton now includes powerful analysis and debugging tools for plugin developers:

#### **`getConfig(): Bun.BuildConfig | null`**

Access the current merged build configuration from all plugins.

```typescript
import { builder } from "frame-master/build";

const config = builder.getConfig();
if (config) {
  console.log("Building for:", config.target);
  console.log("External packages:", config.external);
}
```

#### **`analyzeBuild()`**

Get detailed analysis of build outputs with size metrics and optimization insights.

```typescript
const analysis = builder.analyzeBuild();
console.log("Total size:", analysis.totalSize, "bytes");
console.log("Average file size:", analysis.averageSize, "bytes");
console.log("Largest files:", analysis.largestFiles);
console.log("By artifact kind:", analysis.byKind);
```

Returns:

- `totalSize`: Total bytes across all artifacts
- `averageSize`: Average file size
- `artifacts`: Array of all build outputs with metadata
- `largestFiles`: Top 10 largest files
- `byKind`: Statistics grouped by artifact kind (entry-point, chunk, etc.)

#### **`generateReport(format: "text" | "json")`**

Generate formatted build reports for logging or monitoring.

```typescript
// Human-readable report for console
console.log(builder.generateReport("text"));

// Structured JSON for monitoring systems
const report = builder.generateReport("json");
await sendToMonitoring(JSON.parse(report));
```

#### **`getBuildHistory()`**

Track build performance over time with historical data.

```typescript
const history = builder.getBuildHistory();
const avgDuration =
  history.reduce((s, b) => s + b.duration, 0) / history.length;
console.log("Average build time:", avgDuration.toFixed(2), "ms");

// Check for regressions
const lastBuild = history[history.length - 1];
console.log("Last build:", lastBuild.success ? "‚úÖ" : "‚ùå");
```

#### **`clearBuildHistory()`**

Reset build history tracking.

```typescript
builder.clearBuildHistory();
```

### Type-Safe Configuration Helper

#### **`defineBuildConfig<T>(config: T): T`**

New helper function for type-safe build configurations with full IntelliSense support.

```typescript
import { defineBuildConfig } from "frame-master/build";

export function myPlugin(): FrameMasterPlugin {
  return {
    name: "my-plugin",
    build: {
      buildConfig: defineBuildConfig({
        target: "browser", // Full autocomplete!
        external: ["react", "react-dom"],
        minify: process.env.NODE_ENV === "production",
        // TypeScript catches typos and invalid values
      }),
    },
  };
}
```

**Benefits:**

- Zero runtime overhead (identity function)
- Full TypeScript IntelliSense
- Prevents configuration errors at development time

### Architectural Improvements

#### **Eliminated Circular Dependency Issues**

Frame-Master's internal architecture has been redesigned to eliminate circular dependency problems entirely.

**Key changes:**

- **Lazy initialization pattern**: `config`, `builder`, and `pluginLoader` are now `null` before initialization, preventing circular import issues
- **Accessor function pattern**: Config must now be accessed via the `getConfig()` function instead of direct imports
- **Hook-based access**: Plugins must access `builder` and `config` through lifecycle hooks, ensuring proper initialization order

**Migration examples:**

```typescript
// ‚ùå Old pattern (REMOVED - no longer works)
import config from "frame-master/server/config";
console.log(config.HTTPServer.port); // Error: default export removed

// ‚úÖ New pattern (function-based access)
import { getConfig } from "frame-master/server/config";
const config = getConfig();
if (config) {
  console.log(config.HTTPServer.port);
}

// ‚úÖ Best practice (use lifecycle hooks in plugins)
export function myPlugin(): FrameMasterPlugin {
  return {
    name: "my-plugin",
    serverStart: async (server, config) => {
      // Config provided as hook parameter - always initialized
      console.log("Port:", config.HTTPServer.port);
    },
    build: {
      beforeBuild: async (buildConfig, builder) => {
        // Access via builder if needed in build hooks
        const config = builder.getConfig();
        if (config) {
          console.log("Port:", config.HTTPServer.port);
        }
      },
    },
  };
}
```

**Benefits:**

- **Eliminated circular dependency errors** - no more cryptic runtime failures
- **Deterministic initialization order** - config/builder/pluginLoader are `null` until initialized
- **Safer plugin development** - function pattern prevents premature access
- **Fully documented API** - comprehensive JSDoc on all config methods

### CLI Enhancements

#### **Enhanced Plugin Info Command**

The `frame-master plugin info` command now displays comprehensive build lifecycle information.

```bash
frame-master plugin info my-plugin
```

**New output includes:**

```
üìã Plugin Information:

Name: my-plugin
Version: 1.0.0
Priority: 5

Features:
  Router:
    ‚úì before_request
    ‚úì request
  Server Lifecycle:
    ‚úì main
    ‚úì dev_main
  Build Lifecycle:
    ‚úì buildConfig (dynamic)
    ‚úì beforeBuild
    ‚úì afterBuild
  WebSocket:
    ‚úì onOpen
    ‚úì onMessage
  File System:
    ‚úì Watching 2 directories
```

**Build Lifecycle details:**

- Shows whether `buildConfig` is **static** (object) or **dynamic** (function)
- Displays which build hooks are implemented (`beforeBuild`, `afterBuild`)
- Provides complete visibility into plugin capabilities

This makes it easier to understand what features each plugin provides and how it integrates with Frame-Master's build system.

### Testing Infrastructure

#### **Comprehensive CLI Test Suite**

Added extensive test coverage for all CLI commands using Bun's test API.

**Test coverage includes:**

- ‚úÖ **Version and help commands** - `--version`, `--help`, `-h`
- ‚úÖ **Create command** - Project creation with different types
- ‚úÖ **Init command** - Initialization in existing projects, file overwrite protection
- ‚úÖ **Plugin commands** - list, list --verbose, info, validate, create
- ‚úÖ **Dev and start commands** - Help text validation
- ‚úÖ **Error handling** - Invalid commands, missing arguments

**Key features:**

- Isolated test environment using temporary directories
- Automatic cleanup after test runs
- Tests actual CLI behavior with subprocess execution
- Validates both stdout and stderr output
- Checks file creation and content
- Ensures proper exit codes

Run tests with:

```bash
bun test test/cli.test.ts
```

This ensures CLI reliability and prevents regressions in command-line functionality.

---

## üìö Documentation Improvements

### README Refinement

Complete rewrite of the README to reduce bloat and improve clarity:

- **21% reduction** in length (685 ‚Üí 538 lines) while preserving all critical information
- **Clearer positioning**: Frame-Master as a "plugin orchestration runtime"
- **Emphasized zero built-in behavior**: No opinions, routes, or renderers by default
- **Singleton builder pattern**: Clear explanation of how all plugins share one build pipeline
- **Runtime vs Build plugins**: Clear distinction with comparison table
- **Condensed examples**: Removed redundant code and comments
- **Better structure**: Information flows more logically with less repetition

Key sections improved:

- Core Philosophy (more concise)
- Architecture (simplified diagram)
- Plugin System (consolidated examples)
- Singleton Builder Pattern (single clear example)
- Builder API (3 concise sections vs verbose paragraphs)

### Enhanced Type Documentation

**`BuildOptionsPlugin` type** now includes:

- **Static vs Dynamic configs**: Clear explanation of when to use each
- **Singleton pattern details**: How all plugins share the builder
- **Intelligent merging strategies**: How configs from multiple plugins merge
  - Arrays: Deduplicated and concatenated
  - Objects: Deep merged
  - Plugins: Concatenated (preserve order)
  - Primitives: Last wins with warning
- **15+ practical examples**: Real-world usage patterns
- **Comprehensive hook documentation**: Every hook explained with examples

### Configuration Methods Documentation

All configuration management methods now have comprehensive JSDoc documentation:

**`ConfigManager` class:**

- Class-level documentation explaining lazy initialization pattern
- `config` getter for accessing merged configuration
- `loadConfig()` - Internal initialization with fallback handling
- `reloadConfig()` - Hot-reload capability for development
- `getConfig()` - Safe access method returning `null` before initialization

**Exported functions:**

- `configManager` - Singleton instance with public API
- `loadConfig()` - Initialization function (called by Frame-Master)
- `reloadConfig()` - Configuration reload for hot-reloading
- `getConfig()` - **Primary API** with detailed usage examples

Each method includes:

- Purpose and behavior description
- Return type documentation
- Practical usage examples
- Best practice guidance (use lifecycle hooks when possible)

---

## üîß API Changes

### New Exports

```typescript
// Configuration access (UPDATED)
import {
  getConfig, // Access config safely (returns null before init)
  loadConfig, // Initialize/load config
  reloadConfig, // Reload config
  configManager, // ConfigManager instance
} from "frame-master/server/config";

// Build API
import {
  builder, // Existing (may be null before init)
  Builder, // Existing
  defineBuildConfig, // NEW
} from "frame-master/build";

// Plugin loader
import { pluginLoader } from "frame-master/plugins"; // May be null before init
```

### Builder Class

**New public methods:**

- `getConfig()`
- `analyzeBuild()`
- `generateReport(format)`
- `getBuildHistory()`
- `clearBuildHistory()`

**New static helper:**

- `defineBuildConfig<T>(config: T): T`

---

## üí° Usage Examples

### Bundle Size Monitoring

```typescript
export function monitoringPlugin(): FrameMasterPlugin {
  return {
    name: "monitoring",
    build: {
      afterBuild: async (config, result, builder) => {
        const analysis = builder.analyzeBuild();

        if (analysis.totalSize > 2_000_000) {
          console.error("‚ùå Bundle exceeds 2MB limit!");
          process.exit(1);
        }

        await fetch("https://monitor.example.com/builds", {
          method: "POST",
          body: builder.generateReport("json"),
        });
      },
    },
  };
}
```

### Performance Tracking

```typescript
export function perfPlugin(): FrameMasterPlugin {
  return {
    name: "perf-tracker",
    build: {
      afterBuild: async () => {
        const history = builder.getBuildHistory();
        const last10 = history.slice(-10);
        const avg = last10.reduce((s, b) => s + b.duration, 0) / last10.length;

        console.log(`üìä Last 10 builds avg: ${avg.toFixed(2)}ms`);

        if (avg > 5000) {
          console.warn("‚ö†Ô∏è Builds are getting slow! Consider optimizing.");
        }
      },
    },
  };
}
```

---

## üîÑ Breaking Changes

### Configuration Access Pattern

**‚ö†Ô∏è BREAKING: Default config export has been removed entirely.**

The old pattern of importing config directly is **no longer supported**:

```typescript
// ‚ùå REMOVED - No longer works (will cause errors)
import config from "frame-master/server/config";
console.log(config.HTTPServer.port); // Error!

// ‚úÖ New (required)
import { getConfig } from "frame-master/server/config";
const config = getConfig();
if (config) {
  console.log(config.HTTPServer.port);
}

// ‚úÖ Best practice (in plugins - access through hooks)
export function myPlugin(): FrameMasterPlugin {
  return {
    name: "my-plugin",
    serverStart: async (server, config) => {
      // Config is provided as parameter in lifecycle hooks
      console.log("Port:", config.HTTPServer.port);
    },
  };
}
```

**Why this change?**

The default export pattern caused circular dependency issues that were impossible to resolve gracefully. The new `getConfig()` function pattern with lazy initialization eliminates these issues entirely.

**Impact:** High - All direct config imports must be updated.

**Migration steps:**

1. Replace `import config from "frame-master/server/config"` with `import { getConfig } from "frame-master/server/config"`
2. Call `getConfig()` to access config and handle the `null` case
3. Better: Access config through plugin lifecycle hook parameters (recommended)

---

## üêõ Bug Fixes

_(To be added)_

---

## üìñ Additional Documentation

_(To be added)_

---

## üôè Credits

Special thanks to Bun.js for so much work done!

---

## üì¶ Installation

```bash
# Update to v1.2.0
bun add -g frame-master@1.2.0

# Or in your project
bun add frame-master@1.2.0
```

---

## üîó Links

- [Full Changelog](https://github.com/shpaw415/frame-master/compare/v1.1.0...v1.2.0)
- [Documentation](https://frame-master.com/docs)
- [Plugin Development Guide](https://frame-master.com/docs/plugins)

---

**Note:** This is a draft release note. Additional bug fixes and documentation updates will be added before final release.
