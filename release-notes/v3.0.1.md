# v3.0.1

## Bug Fixes

### Request Manager: HTML Modifiers Applied Only to HTML Responses

Fixed an issue where `HTML_rewrite` plugins and `GlobalValueInjection` were being applied to **all** responses, including JSON and plain text. Now these modifiers are only applied when the response `Content-Type` is `text/html`.

**Before:** JSON responses like `{"data": "test"}` could be corrupted by HTML processing.

**After:** Only HTML responses receive the `globalThis` script injection and HTML rewrite transformations.

---

### CLI: Plugin Template Variable Replacement

Fixed the `frame-master plugin create` command where the `${name}` variable in `README.template.md` was not being replaced with the actual plugin name.

The `formatTemplateFile` function now correctly handles all three template variables:

- `${NAME}` → plugin name
- `__PluginName__` → plugin name (for package references)
- `__CleanPluginName__` → plugin name without dashes (for JavaScript identifiers)

---

### DirectiveTool: Plugin Config Linkage

Fixed an issue where custom directives defined in plugin configurations were not being registered to the `directiveToolSingleton`. Plugins can now define directives that are automatically available throughout the plugins.

**Usage:**

```typescript
// In your plugin
{
  name: "my-plugin",
  version: "1.0.0",
  directives: [
    {
      name: "use-my-directive",
      regex: /^(?:\s*(?:\/\/.*?\n|\s)*)?['"]use[-\s]my-directive['"];?\s*(?:\/\/.*)?(?:\r?\n|$)/m
    }
  ]
}
```

```typescript
// Now works correctly
import { directiveManager } from "frame-master";

await directiveManager.pathIs("use-my-directive", filePath); // ✓ Returns true if directive is present
```

---

### Plugin Chaining: Global Namespace Matching

Fixed an issue where `onLoad` handlers without a namespace were not being applied to custom namespaces. Handlers registered without a namespace are now treated as **global handlers** and are included in all namespace groups.

**Before:** A handler like `build.onLoad({ filter: /.*/ }, ...)` would only match files in the default "file" namespace, not files resolved to custom namespaces via `onResolve`.

**After:** Global handlers (no namespace specified) now match files in **all** namespaces, allowing for universal transformations.

**Example:**

```typescript
{
  name: "my-plugin",
  runtimePlugins: [
    {
      name: "universal-loader",
      setup(build) {
        // Redirects to custom namespace
        build.onResolve({ filter: /^custom:/ }, (args) => ({
          path: args.path.replace("custom:", ""),
          namespace: "custom-ns",
        }));

        // Handler for custom namespace only
        build.onLoad({ filter: /.*/, namespace: "custom-ns" }, async (args) => ({
          contents: `// custom-ns specific\n${args.__chainedContents ?? ""}`,
          loader: "js",
        }));

        // Global handler - now correctly matches ALL namespaces including "custom-ns"
        build.onLoad({ filter: /.*/ }, async (args) => ({
          contents: `// global transform\n${args.__chainedContents ?? ""}`,
          loader: "js",
        }));
      },
    },
  ],
}
```

---

## Upgrade Guide

This is a patch release with no breaking changes. Simply update your dependency:

```bash
bun update frame-master
```
