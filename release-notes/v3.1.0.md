# Frame Master v3.1.0

**Release Date:** December 14, 2025

This minor release introduces new CLI tools for searching plugins and templates from the Frame Master registry, enhanced plugin creation, and improved plugin chaining control.

---

## New Features

### CLI Plugin Search

Search for Frame Master plugins directly from the command line with advanced query syntax.

```bash
# Basic search
frame-master search plugins react

# Advanced search with filters
frame-master search plugins "server side rendering" --category ssr
frame-master search plugins tag:authentication --limit 10
frame-master search plugins author:shpaw415 --sort updated

# Field-specific search syntax
frame-master search plugins name:react-ssr
frame-master search plugins npm:frame-master-plugin
frame-master search plugins -deprecated  # Exclude term

# Output options
frame-master search plugins react --json
frame-master search plugins react --full
```

**Options:**

- `-c, --category <category>` - Filter by category
- `-n, --name <name>` - Filter by exact plugin name
- `-p, --page <page>` - Page number (0-indexed)
- `-l, --limit <limit>` - Results per page (1-100)
- `-s, --sort <field>` - Sort by: relevance, name, created, updated
- `-o, --order <order>` - Sort order: asc, desc
- `--no-fuzzy` - Disable fuzzy matching
- `--include <field>` - Include additional field (longDescription)
- `--full` - Include all plugin fields in results
- `--json` - Output results as JSON

---

### CLI Template Search

Search for project templates to kickstart your Frame Master projects.

```bash
# Basic search
frame-master search templates react

# Search with filters
frame-master search templates --category starter
frame-master search templates "full stack" --sort name --order asc

# Advanced query syntax
frame-master search templates tag:ssr -minimal
frame-master search templates author:shpaw415

# Output options
frame-master search templates --json --limit 5
frame-master search templates --full
```

**Options:**

- `-c, --category <category>` - Filter by category
- `-n, --name <name>` - Filter by exact template name
- `-p, --page <page>` - Page number (0-indexed)
- `-l, --limit <limit>` - Results per page (1-100)
- `-s, --sort <field>` - Sort by: relevance, name, created, updated
- `-o, --order <order>` - Sort order: asc, desc
- `--no-fuzzy` - Disable fuzzy matching
- `--include <field>` - Include additional field (longDescription)
- `--full` - Include all template fields in results
- `--json` - Output results as JSON

---

### Advanced Query Syntax

Both search commands support advanced query syntax:

| Syntax           | Description                          | Example              |
| ---------------- | ------------------------------------ | -------------------- |
| `"exact phrase"` | Search for exact phrase match        | `"server side"`      |
| `-term`          | Exclude results containing term      | `-deprecated`        |
| `name:value`     | Filter by name                       | `name:react-ssr`     |
| `tag:value`      | Filter by tag                        | `tag:authentication` |
| `author:value`   | Filter by author                     | `author:shpaw415`    |
| `npm:value`      | Filter by npm package (plugins only) | `npm:frame-master`   |
| `category:value` | Filter by category                   | `category:ssr`       |

---

### Programmatic API

Both search tools export query builder classes for programmatic use:

```typescript
import { searchPlugins } from "frame-master/search/plugin";
import { searchTemplates } from "frame-master/search/template";

// Plugin search
const plugins = await searchPlugins()
  .query("react")
  .category("ssr")
  .limit(10)
  .sortBy("relevance")
  .execute();

// Template search
const templates = await searchTemplates().query("starter").full(true).execute();
```

---

## Enhancements

### CLI Plugin Creation with Linked package.json

When creating a new plugin with `frame-master plugin create`, the generated `index.ts` now imports `name` and `version` directly from `package.json`. This ensures the plugin metadata stays in sync with the package version automatically.

```typescript
import type { FrameMasterPlugin } from "frame-master/plugin/types";
import { name, version } from "./package.json";

export default function myPlugin(): FrameMasterPlugin {
  return {
    name, // Linked to package.json
    version, // Linked to package.json
    priority: 100,
    // ...
  };
}
```

---

### Plugin Chaining Control with `preventChaining`

Plugin `onLoad` handlers can now stop the chaining pipeline by returning `preventChaining: true`. This is useful when a plugin should be the final handler for a file.

```typescript
build.onLoad({ filter: /\.tsx$/ }, async (args) => {
  const content = args.__chainedContents ?? (await Bun.file(args.path).text());

  return {
    contents: transform(content),
    loader: "tsx",
    preventChaining: true, // No more handlers will run after this
  };
});
```

When `preventChaining: true` is returned, subsequent plugins in the chain are skipped and this handler's result becomes final.

---

### Global Build Entrypoints via `pluginsOptions`

You can now specify additional entrypoints directly in your `frame-master.config.ts` that will be included in every build. This is useful for global scripts like analytics or shared modules.

```typescript
const config: FrameMasterConfig = {
  HTTPServer: { port: 3000 },
  plugins: [myPlugin()],
  pluginsOptions: {
    entrypoints: ["./src/global.ts", "./src/analytics.ts"],
  },
};
```

These entrypoints are merged with those defined in plugin build configs and those passed directly to `builder.build()`.

---

## New Features

### Plugin Builder `finally()` Method

A new `finally()` method has been added to the PluginBuilder interface. This allows plugins to register a final transformation that runs after all chained `onLoad` handlers complete for a specific loader.

```typescript
const myPlugin: BunPlugin = {
  name: "my-plugin",
  setup(build) {
    // Regular onLoad handler
    build.onLoad({ filter: /\.html$/ }, async (args) => {
      const content = await Bun.file(args.path).text();
      return { contents: processHTML(content), loader: "html" };
    });

    // Final transformation after all handlers complete
    build.finally("html", ({ contents, path }) => ({
      contents: `<!-- Generated from ${path} -->\n${contents}`,
    }));
  },
};
```

**Key features:**

- Runs after all chained `onLoad` handlers complete
- Only executes for the matching loader type
- Multiple `finally` handlers for the same loader are chained in registration order
- Supports async callbacks
- Receives `contents`, `path`, and `loader` in the callback
- **Works even without matching `onLoad` handlers** - automatically registers catch-all handlers for loaders with `finally` callbacks

**Use cases:**

- Adding source maps or comments to final output
- Minification as a final step
- Injecting metadata or headers
- Post-processing transformations

---

## Upgrade

```bash
bun update frame-master
```

No breaking changes. This is a drop-in replacement for v3.0.x.
